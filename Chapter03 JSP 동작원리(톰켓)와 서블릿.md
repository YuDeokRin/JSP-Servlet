# Chapter03 JSP 동작원리(톰켓)와 서블릿

# JSP동작 원리(톰캣)와 서블릿

### JSP의 동작구조

정적인 페이지에 대한 요청 , 즉 HTML , 여러 이미지, 텍스트 파일들에 대한 요청은 웹 서버에서 해결합니다. 그리고 동적인 페이지에 대한 요청, 즉 Jsp 페이지에 대한 요청은 웹 서버에서  JSP 컨테이너로 다시 전달됩니다. 이렇게 해서 jsp페이지가 웹 컨테이너에 의해서 실행됩니다.

컨테이너

 들어오는 요청을 처리하고 해당 응답을 생성하는 기능을 가진 구성 요소를 나타냅니다. 엔진은 서비스에 대한 모든 요청을 처리하고 호스트는 특정 가상 호스트에 대한 모든 요청을 처리하며 컨텍스트는 특정 웹 애플리케이션에 대한 모든 요청을 처리합니다.

![Untitled](Chapter03%20JSP%20%E1%84%83%E1%85%A9%E1%86%BC%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%85%E1%85%B5(%E1%84%90%E1%85%A9%E1%86%B7%E1%84%8F%E1%85%A6%E1%86%BA)%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%BA%202945414d3a41407f94c2fd626bc69ee9/Untitled.png)

![Untitled](Chapter03%20JSP%20%E1%84%83%E1%85%A9%E1%86%BC%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%85%E1%85%B5(%E1%84%90%E1%85%A9%E1%86%B7%E1%84%8F%E1%85%A6%E1%86%BA)%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%BA%202945414d3a41407f94c2fd626bc69ee9/Untitled%201.png)

①단계 

사용자의 브라우저에서 [http://servername.../***.jsp의](http://servername.../***.jsp의) 형태로 요청을합니다.

②단계 

웹서버는 ***.jsp의 형태로 온 요청에 대해 JSP 컨테이너로 처리하게끔 요청 정보를 넘깁니다.

③단계

해당 JSP 파일이 처음 요청된 것이라면 JSP 파일을 파싱합니다. 이전에 요청된 것이면 ⑥의 단계로 갑니다.  JSP 파일은 실행을 위해서 결국에 클래스 파일로 변환이 되는데 이런과정은  JSP 파일이 처음으로 호출되었을 때에만 거치게 됩니다. 만일 이전에 어떤 jsp파일이 호출이 되었다면 두 번째 이후로 들어온 해당 JSP 파일의 요청에 대해서 ④, ⑤단계의 생성 및 변환 과정은 거치지 않게 됩니다.

④단계 

JSP파일로부터 서블릿이라는 새로운 자바 파일이 생성됩니다. JSP 파일을 기본으로 해서 서블릿이라는  자바 파일이 새롭게 생성됩니다.

⑤단계

서블릿 파일은 실행 가능한 상태인 클래스 파일로 컴파일 됩니다.

⑥단계

클래스 파일이 메모리에 적재가 되어 실행됩니다.

⑦단계

클래스 파일의 실행결과는 다시 웹 서버에게 넘겨져 웹 서버는 HTML 형태로 사용자에게 응답 내용을 전송합니다. 이는  처음에 사용자가 JSP파일을 요청한 것에 대한 응답으로 HTML 형태의 내용을 전송하게 되는 것입니다.

⑧단계

웹 서버로부터 받은 응답인 HTML로 구성된 페이지를 브라우저에서 실행시켜서 웹 페이지가 보이게 됩니다. 여러분의 브라우저는 HTML 태그로 구성된 페이지를 실행시켜주는 프로그램입니다.

- **JSP동작구조** **단계별 요약**
    
    ①jsp파일요청
    
    ②Web Server는 *.jsp 로 들어온 요청에 대해서 jsp컨테이너로 전송
    
    ③JSP파일 파싱
    
    ④서블릿 생성
    
    ⑤생성된 서블릿 컴파일
    
    ⑥컴파일 된 클래스 파일에 메모리 적재
    
    ⑦HTML 형태인 응답을 사용자로 전송
    
    ⑧사용자의 브라우저에서 HTML이 실행되어서 웹 페이지를 보여줌
    

- **Tip.파싱**
    
    서블릿이라는 파일을 JSP컨테이너가 만들어 내기 위해 JSP가 어떤 작업을 하는 파일인지 알아야합니다. 그러기 위해서 JSP파일을 정확하게, 오타나 논리적인 오류가 없는지에 대해서 읽는 것이라고 생각합니다.
    

 

- **※주의 - 파싱과정 유무에 따른 차이점**
    
    차이점은 여러분의 브라우저에서도 확인할 수 있습니다. koreaFighting.jsp란 jsp페이지를 약간 변형(프로그램 코드를 변경하기 보다는 중간 중간에 공백이나 엔터키를 쳐서 페이지를 새롭게 저장)시켜서 저장한 다음 브라우저에서 '[http://localhost:8080/myapp/koreaFighting.jsp](http://localhost:8080/myapp/koreaFighting.jsp)'라고 호출을 하면 상태바(status bar)가 조금씩 변하면서 시간이 조금 흐른 후에 브라우저에 "KoreaFighting!!"이란 문자열이 출력되는 것을 확인할 수 있습니다. 그런 다음 새로운 브라우저를 열어서 위아 같이 JSP  파일을 호출하였을 떄는 "KoreaFighting!!"이라는 문자열이 처음에 호출됐을 때 보다 빨리 실행되는 것을 확인할 수 있을 것입니다.
    

⑥번 단계에서 '클래스 파일이 메모리에 적재가 된다.' 라고 했는데 이미 설명한대로 첫 요청에 대해서 jsp 페이지는 서블릿 파일로 다시 생성이 됩니다. 그리고 다시 컴파일 단계를 거쳐서 메모리에 적재가 되는 것 입니다.

물론 매번 요청이 있을 때마다 메모리에 적재가 되는 것은 아닙니다. 서블릿 파일이 생성된 후 컴파일 되어 메모리에 적재가 되면(객체의 생성)매번 요청이 해당 서블릿으로 들어 올 때마다 스레드 기반 하에 작은 프로세스를 생성하여 여러 개의 동시 요청을 처리하게 되는 것입니다.

기억! - 모든 요청시마다 매번 메모리에 적재가 되는 방식이 아니라는 점

요약! - JSP페이지는 서블릿으로 변환이 되어 요청에 대한 응답을 생성한다.라고 요약

## JSP의 Life Cycle

![Untitled](Chapter03%20JSP%20%E1%84%83%E1%85%A9%E1%86%BC%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%85%E1%85%B5(%E1%84%90%E1%85%A9%E1%86%B7%E1%84%8F%E1%85%A6%E1%86%BA)%E1%84%8B%E1%85%AA%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%BA%202945414d3a41407f94c2fd626bc69ee9/Untitled%202.png)

■**JSP의 Life Cycle 요약**

- nit()메소드 수행으로 처리에 필요한 자원의 초기화 작업을 합니다.
- service() 메소드 수행으로 요청에 대해서 필요한 처리를 합니다. 실제 요청에 대한 처리를 담당하는 메소드로 필요한 로직이 담겨있는 메소드입니다.
- destroy()메소드 수행으로 사용된 자원을 해제한 뒤 서블릿을 종료 시킵니다.

**서블릿이란?** 

- JSP이전 세대의 동적 웹페이지 생성 언어
- Server + Applet의 합성어 → Servlet
- 브라우저에서 호출하면 WAS에서 웹 페이지를 동적으로 생성

■**서블릿의 Life Cycle 요약**

①브라우저에서 서블릿을 호출하면 WAS는 서블릿 클래스를 로딩합니다.

(호출되는 서블릿은 web.xml에서 매핑이 되어 있습니다.)

②서블릿 클래스가 로딩이 되면 인스턴스가 생성이 되고 약속된 서블릿 Life Cycle로 init() 메소드가 자동적으로 호출이 됩니다.

(자바응용프로그램은main()메소드가 호출되듯이..)

③호출된 서블릿 인스턴스로 부터 스레드를 생성하고 서블릿 클래스에 있는 service() 메소드를 호출합니다.

④서블릿 종료 시  destory() 메소드를 호출합니다.